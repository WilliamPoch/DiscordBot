Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(searchElement,fromIndex){if(null==this)throw new TypeError('"this" is null or not defined');var o=Object(this),len=o.length>>>0;if(0===len)return!1;var x,y,n=0|fromIndex,k=Math.max(n>=0?n:len-Math.abs(n),0);for(;k<len;){if((x=o[k])===(y=searchElement)||"number"==typeof x&&"number"==typeof y&&isNaN(x)&&isNaN(y))return!0;k++}return!1}}),String.prototype.codePointAt||function(){"use strict";var defineProperty=function(){try{var object={},$defineProperty=Object.defineProperty,result=$defineProperty(object,object,object)&&$defineProperty}catch(error){}return result}(),codePointAt=function(position){if(null==this)throw TypeError();var string=String(this),size=string.length,index=position?Number(position):0;if(index!=index&&(index=0),!(index<0||index>=size)){var second,first=string.charCodeAt(index);return first>=55296&&first<=56319&&size>index+1&&(second=string.charCodeAt(index+1))>=56320&&second<=57343?1024*(first-55296)+second-56320+65536:first}};defineProperty?defineProperty(String.prototype,"codePointAt",{value:codePointAt,configurable:!0,writable:!0}):String.prototype.codePointAt=codePointAt}(),Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:Array.prototype.slice}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):global.WaveFile=factory()}(this,function(){"use strict";for(var chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup=new Uint8Array(256),i=0;i<chars.length;i++)lookup[chars.charCodeAt(i)]=i;var f64f32_=new Float32Array(1);function bitDepth(input,original,target,output){validateBitDepth_(original),validateBitDepth_(target);var toFunction=function(original,target){var func=function(x){return x};original!=target&&(func=["32f","64"].includes(original)?["32f","64"].includes(target)?floatToFloat_:floatToInt_:["32f","64"].includes(target)?intToFloat_:intToInt_);return func}(original,target),options={oldMin:Math.pow(2,parseInt(original,10))/2,newMin:Math.pow(2,parseInt(target,10))/2,oldMax:Math.pow(2,parseInt(original,10))/2-1,newMax:Math.pow(2,parseInt(target,10))/2-1},len=input.length;if("8"==original)for(var i=0;i<len;i++)output[i]=input[i]-=128;for(var _i=0;_i<len;_i++)output[_i]=toFunction(input[_i],options);if("8"==target)for(var _i2=0;_i2<len;_i2++)output[_i2]=output[_i2]+=128}function intToInt_(sample,args){return sample=sample>0?parseInt(sample/args.oldMax*args.newMax,10):parseInt(sample/args.oldMin*args.newMin,10)}function floatToInt_(sample,args){return parseInt(sample>0?sample*args.newMax:sample*args.newMin,10)}function intToFloat_(sample,args){return sample>0?sample/args.oldMax:sample/args.oldMin}function floatToFloat_(sample){return f64f32_[0]=sample,f64f32_[0]}function validateBitDepth_(bitDepth){if("32f"!=bitDepth&&"64"!=bitDepth&&(parseInt(bitDepth,10)<"8"||parseInt(bitDepth,10)>"53"))throw new Error("Invalid bit depth.")}var INDEX_TABLE=[-1,-1,-1,-1,2,4,6,8,-1,-1,-1,-1,2,4,6,8],STEP_TABLE=[7,8,9,10,11,12,13,14,16,17,19,21,23,25,28,31,34,37,41,45,50,55,60,66,73,80,88,97,107,118,130,143,157,173,190,209,230,253,279,307,337,371,408,449,494,544,598,658,724,796,876,963,1060,1166,1282,1411,1552,1707,1878,2066,2272,2499,2749,3024,3327,3660,4026,4428,4871,5358,5894,6484,7132,7845,8630,9493,10442,11487,12635,13899,15289,16818,18500,20350,22385,24623,27086,29794,32767],encoderPredicted_=0,encoderIndex_=0,decoderPredicted_=0,decoderIndex_=0,decoderStep_=7;function encodeBlock(block){for(var adpcmSamples=function(sample){encodeSample_(sample);var adpcmSamples=[];return adpcmSamples.push(255&sample),adpcmSamples.push(sample>>8&255),adpcmSamples.push(encoderIndex_),adpcmSamples.push(0),adpcmSamples}(block[0]),i=3;i<block.length;i+=2){var sample2=encodeSample_(block[i]),sample=encodeSample_(block[i+1]);adpcmSamples.push(sample<<4|sample2)}return adpcmSamples}function decodeBlock(block){var num;num=block[1]<<8|block[0],decoderPredicted_=num>32768?num-65536:num,decoderIndex_=block[2],decoderStep_=STEP_TABLE[decoderIndex_];for(var result=[decoderPredicted_,decoderPredicted_],i=4;i<block.length;i++){var original_sample=block[i],second_sample=original_sample>>4,first_sample=second_sample<<4^original_sample;result.push(decodeSample_(first_sample)),result.push(decodeSample_(second_sample))}return result}function encodeSample_(sample){var delta=sample-encoderPredicted_,value=0;delta>=0?value=0:(value=8,delta=-delta);var step=STEP_TABLE[encoderIndex_],diff=step>>3;return delta>step&&(value|=4,delta-=step,diff+=step),delta>(step>>=1)&&(value|=2,delta-=step,diff+=step),delta>(step>>=1)&&(value|=1,diff+=step),function(value,diff){8&value?encoderPredicted_-=diff:encoderPredicted_+=diff;encoderPredicted_<-32768?encoderPredicted_=-32768:encoderPredicted_>32767&&(encoderPredicted_=32767);(encoderIndex_+=INDEX_TABLE[7&value])<0?encoderIndex_=0:encoderIndex_>88&&(encoderIndex_=88)}(value,diff),value}function decodeSample_(nibble){var difference=0;return 4&nibble&&(difference+=decoderStep_),2&nibble&&(difference+=decoderStep_>>1),1&nibble&&(difference+=decoderStep_>>2),difference+=decoderStep_>>3,8&nibble&&(difference=-difference),(decoderPredicted_+=difference)>32767?decoderPredicted_=32767:decoderPredicted_<-32767&&(decoderPredicted_=-32767),function(nibble){(decoderIndex_+=INDEX_TABLE[nibble])<0?decoderIndex_=0:decoderIndex_>88&&(decoderIndex_=88);decoderStep_=STEP_TABLE[decoderIndex_]}(nibble),decoderPredicted_}var LOG_TABLE=[1,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];function encodeSample(sample){var compandedValue=void 0,sign=~(sample=-32768==sample?-32767:sample)>>8&128;if(sign||(sample*=-1),sample>32635&&(sample=32635),sample>=256){var exponent=LOG_TABLE[sample>>8&127];compandedValue=exponent<<4|sample>>exponent+3&15}else compandedValue=sample>>4;return 85^compandedValue^sign}function decodeSample(aLawSample){var sign=0;128&(aLawSample^=85)&&(aLawSample&=-129,sign=-1);var position=4+((240&aLawSample)>>4),decoded=0;return decoded=4!=position?1<<position|(15&aLawSample)<<position-4|1<<position-5:aLawSample<<1|1,8*(decoded=0===sign?decoded:-decoded)*-1}var BIAS=132,CLIP=32635,encodeTable=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],decodeTable=[0,132,396,924,1980,4092,8316,16764];function endianness(bytes,offset){var start=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,end=arguments.length>3&&void 0!==arguments[3]?arguments[3]:bytes.length;if(end%offset)throw new Error("Bad buffer length.");for(var index=start;index<end;index+=offset)swap(bytes,offset,index)}function swap(bytes,offset,index){offset--;for(var x=0;x<offset;x++){var theByte=bytes[index+x];bytes[index+x]=bytes[index+offset],bytes[index+offset]=theByte,offset--}}function pack(str,buffer){for(var index=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=0,len=str.length;i<len;i++){var codePoint=str.codePointAt(i);if(codePoint<128)buffer[index]=codePoint,index++;else{var count=0,offset=0;for(codePoint<=2047?(count=1,offset=192):codePoint<=65535?(count=2,offset=224):codePoint<=1114111&&(count=3,offset=240,i++),buffer[index]=(codePoint>>6*count)+offset,index++;count>0;)buffer[index]=128|codePoint>>6*(count-1)&63,index++,count--}}return index}var TYPE_ERR="Unsupported type",TYPE_NAN="Argument is not a valid number";function validateIsNumber(value){if(null==value)throw new Error(TYPE_NAN);if(value.constructor!==Number&&value.constructor!==Boolean)throw new Error(TYPE_NAN)}var classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;return void 0!==getter?getter.call(receiver):void 0},inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)},possibleConstructorReturn=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call},IEEE754Buffer=function(){function IEEE754Buffer(ebits,fbits){classCallCheck(this,IEEE754Buffer),this.ebits=ebits,this.fbits=fbits,this.bias=(1<<ebits-1)-1,this.numBytes=Math.ceil((ebits+fbits)/8),this.biasP2=Math.pow(2,this.bias+1),this.ebitsFbits=ebits+fbits,this.fbias=Math.pow(2,-(8*this.numBytes-1-ebits))}return createClass(IEEE754Buffer,[{key:"pack",value:function(buffer,num,index){Math.abs(num)>this.biasP2-2*this.ebitsFbits&&(num=num<0?-1/0:1/0);var sign=((num=+num)||1/num)<0?1:num<0?1:0;num=Math.abs(num);var exp=Math.min(Math.floor(Math.log(num)/Math.LN2),1023),fraction=this.roundToEven(num/Math.pow(2,exp)*Math.pow(2,this.fbits));return num!=num?(fraction=Math.pow(2,this.fbits-1),exp=(1<<this.ebits)-1):0!==num&&(num>=Math.pow(2,1-this.bias)?(fraction/Math.pow(2,this.fbits)>=2&&(exp+=1,fraction=1),exp>this.bias?(exp=(1<<this.ebits)-1,fraction=0):(exp+=this.bias,fraction=this.roundToEven(fraction)-Math.pow(2,this.fbits))):(fraction=this.roundToEven(num/Math.pow(2,1-this.bias-this.fbits)),exp=0)),this.packFloatBits_(buffer,index,sign,exp,fraction)}},{key:"unpack",value:function(buffer,index){for(var eMax=(1<<this.ebits)-1,significand=void 0,leftBits="",i=this.numBytes-1;i>=0;i--){var t=buffer[i+index].toString(2);leftBits+="00000000".substring(t.length)+t}var sign="1"==leftBits.charAt(0)?-1:1;leftBits=leftBits.substring(1);var exponent=parseInt(leftBits.substring(0,this.ebits),2);return leftBits=leftBits.substring(this.ebits),exponent==eMax?0!==parseInt(leftBits,2)?NaN:sign*(1/0):(0===exponent?(exponent+=1,significand=parseInt(leftBits,2)):significand=parseInt("1"+leftBits,2),sign*significand*this.fbias*Math.pow(2,exponent-this.bias))}},{key:"packFloatBits_",value:function(buffer,index,sign,exp,fraction){var bits=[];bits.push(sign);for(var i=this.ebits;i>0;i-=1)bits[i]=exp%2?1:0,exp=Math.floor(exp/2);for(var len=bits.length,_i=this.fbits;_i>0;_i-=1)bits[len+_i]=fraction%2?1:0,fraction=Math.floor(fraction/2);for(var str=bits.join(""),numBytes=this.numBytes+index-1,k=index;numBytes>=index;)buffer[numBytes]=parseInt(str.substring(0,8),2),str=str.substring(8),numBytes--,k++;return k}},{key:"roundToEven",value:function(n){var w=Math.floor(n),f=n-w;return f<.5?w:f>.5?w+1:w%2?w+1:w}}]),IEEE754Buffer}(),UintBuffer=function(){function UintBuffer(bits){classCallCheck(this,UintBuffer),this.bits=bits,this.bytes=bits<8?1:Math.ceil(bits/8),this.max=Math.pow(2,bits)-1,this.min=0;var r=8-(1+(bits-1|7)-bits);this.lastByteMask_=Math.pow(2,r>0?r:8)-1}return createClass(UintBuffer,[{key:"pack",value:function(buffer,num){var index=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(num!=num)throw new Error("NaN");this.overflow(num),buffer[index]=255&(num<0?num+Math.pow(2,this.bits):num),index++;for(var len=this.bytes,i=2;i<len;i++)buffer[index]=255&Math.floor(num/Math.pow(2,8*(i-1))),index++;return this.bits>8&&(buffer[index]=Math.floor(num/Math.pow(2,8*(this.bytes-1)))&this.lastByteMask_,index++),index}},{key:"unpack",value:function(buffer){var index=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,num=this.unpackUnsafe(buffer,index);return this.overflow(num),num}},{key:"unpackUnsafe",value:function(buffer,index){for(var num=0,x=0;x<this.bytes;x++)num+=buffer[index+x]*Math.pow(256,x);return num}},{key:"overflow",value:function(num){if(num>this.max||num<this.min)throw new Error("Overflow")}}]),UintBuffer}(),TwosComplementBuffer=function(_UintBuffer){function TwosComplementBuffer(bits){classCallCheck(this,TwosComplementBuffer);var _this=possibleConstructorReturn(this,(TwosComplementBuffer.__proto__||Object.getPrototypeOf(TwosComplementBuffer)).call(this,bits));return _this.max=Math.pow(2,_this.bits)/2-1,_this.min=-_this.max-1,_this}return inherits(TwosComplementBuffer,UintBuffer),createClass(TwosComplementBuffer,[{key:"pack",value:function(buffer,num){var index=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return get(TwosComplementBuffer.prototype.__proto__||Object.getPrototypeOf(TwosComplementBuffer.prototype),"pack",this).call(this,buffer,num,index)}},{key:"unpack",value:function(buffer){var index=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,num=get(TwosComplementBuffer.prototype.__proto__||Object.getPrototypeOf(TwosComplementBuffer.prototype),"unpackUnsafe",this).call(this,buffer,index);return num=this.sign_(num),this.overflow(num),num}},{key:"sign_",value:function(num){return num>this.max&&(num-=2*this.max+2),num}}]),TwosComplementBuffer}(),NumberBuffer=function(){function NumberBuffer(bits,fp,signed){classCallCheck(this,NumberBuffer);var parser=void 0;fp?(!function(bits){if(!bits||16!==bits&&32!==bits&&64!==bits)throw new Error(TYPE_ERR+": float, bits: "+bits)}(bits),parser=this.getFPParser_(bits)):(!function(bits){if(!bits||bits<1||bits>53)throw new Error(TYPE_ERR+": int, bits: "+bits)}(bits),parser=signed?new TwosComplementBuffer(bits):new UintBuffer(bits)),this.parser=parser,this.offset=Math.ceil(bits/8)}return createClass(NumberBuffer,[{key:"unpack",value:function(buffer){var index=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.parser.unpack(buffer,index)}},{key:"pack",value:function(buffer,num){var index=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.parser.pack(buffer,num,index)}},{key:"getFPParser_",value:function(bits){return 16===bits?new IEEE754Buffer(5,11):32===bits?new IEEE754Buffer(8,23):new IEEE754Buffer(11,52)}}]),NumberBuffer}();function throwValueError_(e,value,i,fp){throw fp||value!==1/0&&value!==-1/0&&value==value?new Error(e.message+" at input index "+i+": "+value):new Error("Argument is not a integer at input index "+i)}function unpackString(buffer){return function(buffer){for(var start=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,end=arguments.length>2&&void 0!==arguments[2]?arguments[2]:buffer.length,str="",index=start;index<end;){var lowerBoundary=128,upperBoundary=191,replace=!1,charCode=buffer[index++];if(charCode>=0&&charCode<=127)str+=String.fromCharCode(charCode);else{var count=0;charCode>=194&&charCode<=223?count=1:charCode>=224&&charCode<=239?(count=2,224===buffer[index]&&(lowerBoundary=160),237===buffer[index]&&(upperBoundary=159)):charCode>=240&&charCode<=244?(count=3,240===buffer[index]&&(lowerBoundary=144),244===buffer[index]&&(upperBoundary=143)):replace=!0,charCode&=(1<<8-count-1)-1;for(var i=0;i<count;i++)(buffer[index]<lowerBoundary||buffer[index]>upperBoundary)&&(replace=!0),charCode=charCode<<6|63&buffer[index],index++;replace?str+=String.fromCharCode(65533):charCode<=65535?str+=String.fromCharCode(charCode):(charCode-=65536,str+=String.fromCharCode(55296+(charCode>>10&1023),56320+(1023&charCode)))}}return str}(buffer,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:buffer.length)}function packString(str){var buffer=[];return pack(str,buffer,0),buffer}function packStringTo(str,buffer){return pack(str,buffer,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)}function packArrayTo(values,theType,buffer){var index=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,packer=new NumberBuffer((theType=theType||{}).bits,theType.fp,theType.signed),i=0,start=index;try{for(var valuesLen=values.length;i<valuesLen;i++)validateIsNumber(values[i]),index=packer.pack(buffer,values[i],index);theType.be&&endianness(buffer,packer.offset,start,index)}catch(e){throwValueError_(e,values[i],i,theType.fp)}return index}function unpackArrayTo(buffer,theType,output){var start=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,end=arguments.length>4&&void 0!==arguments[4]?arguments[4]:buffer.length,safe=arguments.length>5&&void 0!==arguments[5]&&arguments[5],packer=new NumberBuffer((theType=theType||{}).bits,theType.fp,theType.signed),offset=packer.offset;end=function(buffer,start,end,offset,safe){var extra=(end-start)%offset;if(safe&&(extra||buffer.length<offset))throw new Error("Bad buffer length");return end-extra}(buffer,start,end,offset,safe);var index=0,j=start;try{for(theType.be&&endianness(buffer,offset,start,end);j<end;j+=offset,index++)output[index]=packer.unpack(buffer,j);theType.be&&endianness(buffer,offset,start,end)}catch(e){throwValueError_(e,buffer.slice(j,j+offset),j,theType.fp)}}function packTo(value,theType,buffer){return packArrayTo([value],theType,buffer,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function pack$1(value,theType){var output=[];return packTo(value,theType,output),output}function unpackArray(buffer,theType){var output=[];return unpackArrayTo(buffer,theType,output,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:buffer.length,arguments.length>4&&void 0!==arguments[4]&&arguments[4]),output}function unpack$1(buffer,theType){var index=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return unpackArray(buffer,theType,index,index+Math.ceil(theType.bits/8),!0)[0]}var RIFFFile=function(){function RIFFFile(){classCallCheck(this,RIFFFile),this.container="",this.chunkSize=0,this.format="",this.signature={},this.head=0,this.uInt32={bits:32,be:!1},this.supported_containers=["RIFF","RIFX"]}return createClass(RIFFFile,[{key:"setSignature",value:function(buffer){if(this.head=0,this.container=this.readString(buffer,4),-1===this.supported_containers.indexOf(this.container))throw Error("Not a supported format.");this.uInt32.be="RIFX"===this.container,this.chunkSize=this.readUInt32(buffer),this.format=this.readString(buffer,4),this.signature={chunkId:this.container,chunkSize:this.chunkSize,format:this.format,subChunks:this.getSubChunksIndex_(buffer)}}},{key:"findChunk",value:function(chunkId){for(var multiple=arguments.length>1&&void 0!==arguments[1]&&arguments[1],chunks=this.signature.subChunks,chunk=[],i=0;i<chunks.length;i++)if(chunks[i].chunkId==chunkId){if(!multiple)return chunks[i];chunk.push(chunks[i])}return"LIST"==chunkId&&chunk.length?chunk:null}},{key:"readString",value:function(bytes,maxSize){var str;return str=unpackString(bytes,this.head,this.head+maxSize),this.head+=maxSize,str}},{key:"readUInt32",value:function(bytes){var value=unpack$1(bytes,this.uInt32,this.head);return this.head+=4,value}},{key:"getSubChunksIndex_",value:function(buffer){for(var chunks=[],i=this.head;i<=buffer.length-8;)chunks.push(this.getSubChunkIndex_(buffer,i)),i=(i+=8+chunks[chunks.length-1].chunkSize)%2?i+1:i;return chunks}},{key:"getSubChunkIndex_",value:function(buffer,index){var chunk={chunkId:this.getChunkId_(buffer,index),chunkSize:this.getChunkSize_(buffer,index)};if("LIST"==chunk.chunkId)chunk.format=unpackString(buffer,index+8,index+12),this.head+=4,chunk.subChunks=this.getSubChunksIndex_(buffer);else{var realChunkSize=chunk.chunkSize%2?chunk.chunkSize+1:chunk.chunkSize;this.head=index+8+realChunkSize,chunk.chunkData={start:index+8,end:this.head}}return chunk}},{key:"getChunkId_",value:function(buffer,index){return this.head+=4,unpackString(buffer,index,index+4)}},{key:"getChunkSize_",value:function(buffer,index){return this.head+=4,unpack$1(buffer,this.uInt32,index+4)}}]),RIFFFile}(),WaveFileReader=function(_RIFFFile){function WaveFileReader(){classCallCheck(this,WaveFileReader);var _this=possibleConstructorReturn(this,(WaveFileReader.__proto__||Object.getPrototypeOf(WaveFileReader)).call(this));return _this.supported_containers.push("RF64"),_this.fmt={chunkId:"",chunkSize:0,audioFormat:0,numChannels:0,sampleRate:0,byteRate:0,blockAlign:0,bitsPerSample:0,cbSize:0,validBitsPerSample:0,dwChannelMask:0,subformat:[]},_this.fact={chunkId:"",chunkSize:0,dwSampleLength:0},_this.cue={chunkId:"",chunkSize:0,dwCuePoints:0,points:[]},_this.smpl={chunkId:"",chunkSize:0,dwManufacturer:0,dwProduct:0,dwSamplePeriod:0,dwMIDIUnityNote:0,dwMIDIPitchFraction:0,dwSMPTEFormat:0,dwSMPTEOffset:0,dwNumSampleLoops:0,dwSamplerData:0,loops:[]},_this.bext={chunkId:"",chunkSize:0,description:"",originator:"",originatorReference:"",originationDate:"",originationTime:"",timeReference:[0,0],version:0,UMID:"",loudnessValue:0,loudnessRange:0,maxTruePeakLevel:0,maxMomentaryLoudness:0,maxShortTermLoudness:0,reserved:"",codingHistory:""},_this.ds64={chunkId:"",chunkSize:0,riffSizeHigh:0,riffSizeLow:0,dataSizeHigh:0,dataSizeLow:0,originationTime:0,sampleCountHigh:0,sampleCountLow:0},_this.data={chunkId:"",chunkSize:0,samples:new Uint8Array(0)},_this.LIST=[],_this.junk={chunkId:"",chunkSize:0,chunkData:[]},_this.uInt16={bits:16,be:!1},_this}return inherits(WaveFileReader,RIFFFile),createClass(WaveFileReader,[{key:"fromBuffer",value:function(wavBuffer){var samples=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.clearHeaders(),this.setSignature(wavBuffer),this.uInt16.be=this.uInt32.be,"WAVE"!=this.format)throw Error('Could not find the "WAVE" format identifier');this.readDs64Chunk_(wavBuffer),this.readFmtChunk_(wavBuffer),this.readFactChunk_(wavBuffer),this.readBextChunk_(wavBuffer),this.readCueChunk_(wavBuffer),this.readSmplChunk_(wavBuffer),this.readDataChunk_(wavBuffer,samples),this.readJunkChunk_(wavBuffer),this.readLISTChunk_(wavBuffer)}},{key:"clearHeaders",value:function(){var tmpWav=new WaveFileReader;Object.assign(this.fmt,tmpWav.fmt),Object.assign(this.fact,tmpWav.fact),Object.assign(this.cue,tmpWav.cue),Object.assign(this.smpl,tmpWav.smpl),Object.assign(this.bext,tmpWav.bext),Object.assign(this.ds64,tmpWav.ds64),Object.assign(this.data,tmpWav.data),this.LIST=[],Object.assign(this.junk,tmpWav.junk)}},{key:"readFmtChunk_",value:function(buffer){var chunk=this.findChunk("fmt ");if(!chunk)throw Error('Could not find the "fmt " chunk');this.head=chunk.chunkData.start,this.fmt.chunkId=chunk.chunkId,this.fmt.chunkSize=chunk.chunkSize,this.fmt.audioFormat=this.readUInt16_(buffer),this.fmt.numChannels=this.readUInt16_(buffer),this.fmt.sampleRate=this.readUInt32(buffer),this.fmt.byteRate=this.readUInt32(buffer),this.fmt.blockAlign=this.readUInt16_(buffer),this.fmt.bitsPerSample=this.readUInt16_(buffer),this.readFmtExtension_(buffer)}},{key:"readFmtExtension_",value:function(buffer){this.fmt.chunkSize>16&&(this.fmt.cbSize=this.readUInt16_(buffer),this.fmt.chunkSize>18&&(this.fmt.validBitsPerSample=this.readUInt16_(buffer),this.fmt.chunkSize>20&&(this.fmt.dwChannelMask=this.readUInt32(buffer),this.fmt.subformat=[this.readUInt32(buffer),this.readUInt32(buffer),this.readUInt32(buffer),this.readUInt32(buffer)])))}},{key:"readFactChunk_",value:function(buffer){var chunk=this.findChunk("fact");chunk&&(this.head=chunk.chunkData.start,this.fact.chunkId=chunk.chunkId,this.fact.chunkSize=chunk.chunkSize,this.fact.dwSampleLength=this.readUInt32(buffer))}},{key:"readCueChunk_",value:function(buffer){var chunk=this.findChunk("cue ");if(chunk){this.head=chunk.chunkData.start,this.cue.chunkId=chunk.chunkId,this.cue.chunkSize=chunk.chunkSize,this.cue.dwCuePoints=this.readUInt32(buffer);for(var i=0;i<this.cue.dwCuePoints;i++)this.cue.points.push({dwName:this.readUInt32(buffer),dwPosition:this.readUInt32(buffer),fccChunk:this.readString(buffer,4),dwChunkStart:this.readUInt32(buffer),dwBlockStart:this.readUInt32(buffer),dwSampleOffset:this.readUInt32(buffer)})}}},{key:"readSmplChunk_",value:function(buffer){var chunk=this.findChunk("smpl");if(chunk){this.head=chunk.chunkData.start,this.smpl.chunkId=chunk.chunkId,this.smpl.chunkSize=chunk.chunkSize,this.smpl.dwManufacturer=this.readUInt32(buffer),this.smpl.dwProduct=this.readUInt32(buffer),this.smpl.dwSamplePeriod=this.readUInt32(buffer),this.smpl.dwMIDIUnityNote=this.readUInt32(buffer),this.smpl.dwMIDIPitchFraction=this.readUInt32(buffer),this.smpl.dwSMPTEFormat=this.readUInt32(buffer),this.smpl.dwSMPTEOffset=this.readUInt32(buffer),this.smpl.dwNumSampleLoops=this.readUInt32(buffer),this.smpl.dwSamplerData=this.readUInt32(buffer);for(var i=0;i<this.smpl.dwNumSampleLoops;i++)this.smpl.loops.push({dwName:this.readUInt32(buffer),dwType:this.readUInt32(buffer),dwStart:this.readUInt32(buffer),dwEnd:this.readUInt32(buffer),dwFraction:this.readUInt32(buffer),dwPlayCount:this.readUInt32(buffer)})}}},{key:"readDataChunk_",value:function(buffer,samples){var chunk=this.findChunk("data");if(!chunk)throw Error('Could not find the "data" chunk');this.data.chunkId="data",this.data.chunkSize=chunk.chunkSize,samples&&(this.data.samples=buffer.slice(chunk.chunkData.start,chunk.chunkData.end))}},{key:"readBextChunk_",value:function(buffer){var chunk=this.findChunk("bext");chunk&&(this.head=chunk.chunkData.start,this.bext.chunkId=chunk.chunkId,this.bext.chunkSize=chunk.chunkSize,this.bext.description=this.readString(buffer,256),this.bext.originator=this.readString(buffer,32),this.bext.originatorReference=this.readString(buffer,32),this.bext.originationDate=this.readString(buffer,10),this.bext.originationTime=this.readString(buffer,8),this.bext.timeReference=[this.readUInt32(buffer),this.readUInt32(buffer)],this.bext.version=this.readUInt16_(buffer),this.bext.UMID=this.readString(buffer,64),this.bext.loudnessValue=this.readUInt16_(buffer),this.bext.loudnessRange=this.readUInt16_(buffer),this.bext.maxTruePeakLevel=this.readUInt16_(buffer),this.bext.maxMomentaryLoudness=this.readUInt16_(buffer),this.bext.maxShortTermLoudness=this.readUInt16_(buffer),this.bext.reserved=this.readString(buffer,180),this.bext.codingHistory=this.readString(buffer,this.bext.chunkSize-602))}},{key:"readDs64Chunk_",value:function(buffer){var chunk=this.findChunk("ds64");if(chunk)this.head=chunk.chunkData.start,this.ds64.chunkId=chunk.chunkId,this.ds64.chunkSize=chunk.chunkSize,this.ds64.riffSizeHigh=this.readUInt32(buffer),this.ds64.riffSizeLow=this.readUInt32(buffer),this.ds64.dataSizeHigh=this.readUInt32(buffer),this.ds64.dataSizeLow=this.readUInt32(buffer),this.ds64.originationTime=this.readUInt32(buffer),this.ds64.sampleCountHigh=this.readUInt32(buffer),this.ds64.sampleCountLow=this.readUInt32(buffer);else if("RF64"==this.container)throw Error('Could not find the "ds64" chunk')}},{key:"readLISTChunk_",value:function(buffer){var listChunks=this.findChunk("LIST",!0);if(null!==listChunks)for(var j=0;j<listChunks.length;j++){var subChunk=listChunks[j];this.LIST.push({chunkId:subChunk.chunkId,chunkSize:subChunk.chunkSize,format:subChunk.format,subChunks:[]});for(var x=0;x<subChunk.subChunks.length;x++)this.readLISTSubChunks_(subChunk.subChunks[x],subChunk.format,buffer)}}},{key:"readLISTSubChunks_",value:function(subChunk,format,buffer){if("adtl"==format){if(["labl","note","ltxt"].indexOf(subChunk.chunkId)>-1){this.head=subChunk.chunkData.start;var item={chunkId:subChunk.chunkId,chunkSize:subChunk.chunkSize,dwName:this.readUInt32(buffer)};"ltxt"==subChunk.chunkId&&(item.dwSampleLength=this.readUInt32(buffer),item.dwPurposeID=this.readUInt32(buffer),item.dwCountry=this.readUInt16_(buffer),item.dwLanguage=this.readUInt16_(buffer),item.dwDialect=this.readUInt16_(buffer),item.dwCodePage=this.readUInt16_(buffer)),item.value=this.readZSTR_(buffer,this.head),this.LIST[this.LIST.length-1].subChunks.push(item)}}else"INFO"==format&&(this.head=subChunk.chunkData.start,this.LIST[this.LIST.length-1].subChunks.push({chunkId:subChunk.chunkId,chunkSize:subChunk.chunkSize,value:this.readZSTR_(buffer,this.head)}))}},{key:"readJunkChunk_",value:function(buffer){var chunk=this.findChunk("junk");chunk&&(this.junk={chunkId:chunk.chunkId,chunkSize:chunk.chunkSize,chunkData:[].slice.call(buffer.slice(chunk.chunkData.start,chunk.chunkData.end))})}},{key:"readZSTR_",value:function(bytes){for(var index=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=index;i<bytes.length&&(this.head++,0!==bytes[i]);i++);return unpackString(bytes,index,this.head-1)}},{key:"readUInt16_",value:function(bytes){var value=unpack$1(bytes,this.uInt16,this.head);return this.head+=2,value}}]),WaveFileReader}();function writeString(str,maxSize){var fixedSize=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],packedString=packString(str);if(fixedSize)for(var i=packedString.length;i<maxSize;i++)packedString.push(0);return packedString}var WaveFileParser=function(_WaveFileReader){function WaveFileParser(){return classCallCheck(this,WaveFileParser),possibleConstructorReturn(this,(WaveFileParser.__proto__||Object.getPrototypeOf(WaveFileParser)).apply(this,arguments))}return inherits(WaveFileParser,WaveFileReader),createClass(WaveFileParser,[{key:"toBuffer",value:function(){this.uInt16.be="RIFX"===this.container,this.uInt32.be=this.uInt16.be;for(var fileBody=[this.getJunkBytes_(),this.getDs64Bytes_(),this.getBextBytes_(),this.getFmtBytes_(),this.getFactBytes_(),packString(this.data.chunkId),pack$1(this.data.samples.length,this.uInt32),this.data.samples,this.getCueBytes_(),this.getSmplBytes_(),this.getLISTBytes_()],fileBodyLength=0,i=0;i<fileBody.length;i++)fileBodyLength+=fileBody[i].length;var file=new Uint8Array(fileBodyLength+12),index=0;index=packStringTo(this.container,file,index),index=packTo(fileBodyLength+4,this.uInt32,file,index),index=packStringTo(this.format,file,index);for(var _i=0;_i<fileBody.length;_i++)file.set(fileBody[_i],index),index+=fileBody[_i].length;return file}},{key:"getBextBytes_",value:function(){var bytes=[];return this.enforceBext_(),this.bext.chunkId&&(this.bext.chunkSize=602+this.bext.codingHistory.length,bytes=bytes.concat(packString(this.bext.chunkId),pack$1(602+this.bext.codingHistory.length,this.uInt32),writeString(this.bext.description,256),writeString(this.bext.originator,32),writeString(this.bext.originatorReference,32),writeString(this.bext.originationDate,10),writeString(this.bext.originationTime,8),pack$1(this.bext.timeReference[0],this.uInt32),pack$1(this.bext.timeReference[1],this.uInt32),pack$1(this.bext.version,this.uInt16),writeString(this.bext.UMID,64),pack$1(this.bext.loudnessValue,this.uInt16),pack$1(this.bext.loudnessRange,this.uInt16),pack$1(this.bext.maxTruePeakLevel,this.uInt16),pack$1(this.bext.maxMomentaryLoudness,this.uInt16),pack$1(this.bext.maxShortTermLoudness,this.uInt16),writeString(this.bext.reserved,180),writeString(this.bext.codingHistory,this.bext.codingHistory.length))),bytes}},{key:"enforceBext_",value:function(){for(var prop in this.bext)if(this.bext.hasOwnProperty(prop)&&this.bext[prop]&&"timeReference"!=prop){this.bext.chunkId="bext";break}(this.bext.timeReference[0]||this.bext.timeReference[1])&&(this.bext.chunkId="bext")}},{key:"getDs64Bytes_",value:function(){var bytes=[];return this.ds64.chunkId&&(bytes=bytes.concat(packString(this.ds64.chunkId),pack$1(this.ds64.chunkSize,this.uInt32),pack$1(this.ds64.riffSizeHigh,this.uInt32),pack$1(this.ds64.riffSizeLow,this.uInt32),pack$1(this.ds64.dataSizeHigh,this.uInt32),pack$1(this.ds64.dataSizeLow,this.uInt32),pack$1(this.ds64.originationTime,this.uInt32),pack$1(this.ds64.sampleCountHigh,this.uInt32),pack$1(this.ds64.sampleCountLow,this.uInt32))),bytes}},{key:"getCueBytes_",value:function(){var bytes=[];if(this.cue.chunkId){var cuePointsBytes=this.getCuePointsBytes_();bytes=bytes.concat(packString(this.cue.chunkId),pack$1(cuePointsBytes.length+4,this.uInt32),pack$1(this.cue.dwCuePoints,this.uInt32),cuePointsBytes)}return bytes}},{key:"getCuePointsBytes_",value:function(){for(var points=[],i=0;i<this.cue.dwCuePoints;i++)points=points.concat(pack$1(this.cue.points[i].dwName,this.uInt32),pack$1(this.cue.points[i].dwPosition,this.uInt32),packString(this.cue.points[i].fccChunk),pack$1(this.cue.points[i].dwChunkStart,this.uInt32),pack$1(this.cue.points[i].dwBlockStart,this.uInt32),pack$1(this.cue.points[i].dwSampleOffset,this.uInt32));return points}},{key:"getSmplBytes_",value:function(){var bytes=[];if(this.smpl.chunkId){var smplLoopsBytes=this.getSmplLoopsBytes_();bytes=bytes.concat(packString(this.smpl.chunkId),pack$1(smplLoopsBytes.length+36,this.uInt32),pack$1(this.smpl.dwManufacturer,this.uInt32),pack$1(this.smpl.dwProduct,this.uInt32),pack$1(this.smpl.dwSamplePeriod,this.uInt32),pack$1(this.smpl.dwMIDIUnityNote,this.uInt32),pack$1(this.smpl.dwMIDIPitchFraction,this.uInt32),pack$1(this.smpl.dwSMPTEFormat,this.uInt32),pack$1(this.smpl.dwSMPTEOffset,this.uInt32),pack$1(this.smpl.dwNumSampleLoops,this.uInt32),pack$1(this.smpl.dwSamplerData,this.uInt32),smplLoopsBytes)}return bytes}},{key:"getSmplLoopsBytes_",value:function(){for(var loops=[],i=0;i<this.smpl.dwNumSampleLoops;i++)loops=loops.concat(pack$1(this.smpl.loops[i].dwName,this.uInt32),pack$1(this.smpl.loops[i].dwType,this.uInt32),pack$1(this.smpl.loops[i].dwStart,this.uInt32),pack$1(this.smpl.loops[i].dwEnd,this.uInt32),pack$1(this.smpl.loops[i].dwFraction,this.uInt32),pack$1(this.smpl.loops[i].dwPlayCount,this.uInt32));return loops}},{key:"getFactBytes_",value:function(){var bytes=[];return this.fact.chunkId&&(bytes=bytes.concat(packString(this.fact.chunkId),pack$1(this.fact.chunkSize,this.uInt32),pack$1(this.fact.dwSampleLength,this.uInt32))),bytes}},{key:"getFmtBytes_",value:function(){if(this.fmt.chunkId)return[].concat(packString(this.fmt.chunkId),pack$1(this.fmt.chunkSize,this.uInt32),pack$1(this.fmt.audioFormat,this.uInt16),pack$1(this.fmt.numChannels,this.uInt16),pack$1(this.fmt.sampleRate,this.uInt32),pack$1(this.fmt.byteRate,this.uInt32),pack$1(this.fmt.blockAlign,this.uInt16),pack$1(this.fmt.bitsPerSample,this.uInt16),this.getFmtExtensionBytes_());throw Error('Could not find the "fmt " chunk')}},{key:"getFmtExtensionBytes_",value:function(){var extension=[];return this.fmt.chunkSize>16&&(extension=extension.concat(pack$1(this.fmt.cbSize,this.uInt16))),this.fmt.chunkSize>18&&(extension=extension.concat(pack$1(this.fmt.validBitsPerSample,this.uInt16))),this.fmt.chunkSize>20&&(extension=extension.concat(pack$1(this.fmt.dwChannelMask,this.uInt32))),this.fmt.chunkSize>24&&(extension=extension.concat(pack$1(this.fmt.subformat[0],this.uInt32),pack$1(this.fmt.subformat[1],this.uInt32),pack$1(this.fmt.subformat[2],this.uInt32),pack$1(this.fmt.subformat[3],this.uInt32))),extension}},{key:"getLISTBytes_",value:function(){for(var bytes=[],i=0;i<this.LIST.length;i++){var subChunksBytes=this.getLISTSubChunksBytes_(this.LIST[i].subChunks,this.LIST[i].format);bytes=bytes.concat(packString(this.LIST[i].chunkId),pack$1(subChunksBytes.length+4,this.uInt32),packString(this.LIST[i].format),subChunksBytes)}return bytes}},{key:"getLISTSubChunksBytes_",value:function(subChunks,format){for(var bytes=[],i=0;i<subChunks.length;i++)"INFO"==format?(bytes=bytes.concat(packString(subChunks[i].chunkId),pack$1(subChunks[i].value.length+1,this.uInt32),writeString(subChunks[i].value,subChunks[i].value.length))).push(0):"adtl"==format&&(["labl","note"].indexOf(subChunks[i].chunkId)>-1?(bytes=bytes.concat(packString(subChunks[i].chunkId),pack$1(subChunks[i].value.length+4+1,this.uInt32),pack$1(subChunks[i].dwName,this.uInt32),writeString(subChunks[i].value,subChunks[i].value.length))).push(0):"ltxt"==subChunks[i].chunkId&&(bytes=bytes.concat(this.getLtxtChunkBytes_(subChunks[i])))),bytes.length%2&&bytes.push(0);return bytes}},{key:"getLtxtChunkBytes_",value:function(ltxt){return[].concat(packString(ltxt.chunkId),pack$1(ltxt.value.length+20,this.uInt32),pack$1(ltxt.dwName,this.uInt32),pack$1(ltxt.dwSampleLength,this.uInt32),pack$1(ltxt.dwPurposeID,this.uInt32),pack$1(ltxt.dwCountry,this.uInt16),pack$1(ltxt.dwLanguage,this.uInt16),pack$1(ltxt.dwDialect,this.uInt16),pack$1(ltxt.dwCodePage,this.uInt16),writeString(ltxt.value,ltxt.value.length))}},{key:"getJunkBytes_",value:function(){var bytes=[];return this.junk.chunkId?bytes.concat(packString(this.junk.chunkId),pack$1(this.junk.chunkData.length,this.uInt32),this.junk.chunkData):bytes}}]),WaveFileParser}();var WaveFileCreator=function(_WaveFileParser){function WaveFileCreator(){classCallCheck(this,WaveFileCreator);var _this=possibleConstructorReturn(this,(WaveFileCreator.__proto__||Object.getPrototypeOf(WaveFileCreator)).call(this));return _this.bitDepth="0",_this.dataType={},_this.WAV_AUDIO_FORMATS={4:17,8:1,"8a":6,"8m":7,16:1,24:1,32:1,"32f":3,64:3},_this}return inherits(WaveFileCreator,WaveFileParser),createClass(WaveFileCreator,[{key:"fromScratch",value:function(numChannels,sampleRate,bitDepthCode,samples){var options=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};this.clearHeaders(),this.newWavFile_(numChannels,sampleRate,bitDepthCode,samples,options)}},{key:"newWavFile_",value:function(numChannels,sampleRate,bitDepthCode,samples){var options=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};options.container||(options.container="RIFF"),this.container=options.container,this.bitDepth=bitDepthCode,samples=function(samples){if(samples.length>0&&samples[0].constructor===Array){for(var finalSamples=[],i=0,len=samples[0].length;i<len;i++)for(var j=0,subLen=samples.length;j<subLen;j++)finalSamples.push(samples[j][i]);samples=finalSamples}return samples}(samples),this.updateDataType_();var numBytes=this.dataType.bits/8;this.data.samples=new Uint8Array(samples.length*numBytes),packArrayTo(samples,this.dataType,this.data.samples),this.makeWavHeader_(bitDepthCode,numChannels,sampleRate,numBytes,this.data.samples.length,options),this.data.chunkId="data",this.data.chunkSize=this.data.samples.length,this.validateWavHeader_()}},{key:"fromBuffer",value:function(wavBuffer){var samples=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];get(WaveFileCreator.prototype.__proto__||Object.getPrototypeOf(WaveFileCreator.prototype),"fromBuffer",this).call(this,wavBuffer,samples),this.bitDepthFromFmt_(),this.updateDataType_()}},{key:"toBuffer",value:function(){return this.validateWavHeader_(),get(WaveFileCreator.prototype.__proto__||Object.getPrototypeOf(WaveFileCreator.prototype),"toBuffer",this).call(this)}},{key:"getSample",value:function(index){if((index*=this.dataType.bits/8)+this.dataType.bits/8>this.data.samples.length)throw new Error("Range error");return unpack$1(this.data.samples.slice(index,index+this.dataType.bits/8),this.dataType)}},{key:"setSample",value:function(index,sample){if((index*=this.dataType.bits/8)+this.dataType.bits/8>this.data.samples.length)throw new Error("Range error");packTo(sample,this.dataType,this.data.samples,index)}},{key:"makeWavHeader_",value:function(bitDepthCode,numChannels,sampleRate,numBytes,samplesLength,options){"4"==bitDepthCode?this.createADPCMHeader_(bitDepthCode,numChannels,sampleRate,numBytes,samplesLength,options):"8a"==bitDepthCode||"8m"==bitDepthCode?this.createALawMulawHeader_(bitDepthCode,numChannels,sampleRate,numBytes,samplesLength,options):-1==Object.keys(this.WAV_AUDIO_FORMATS).indexOf(bitDepthCode)||numChannels>2?this.createExtensibleHeader_(bitDepthCode,numChannels,sampleRate,numBytes,samplesLength,options):this.createPCMHeader_(bitDepthCode,numChannels,sampleRate,numBytes,samplesLength,options)}},{key:"createPCMHeader_",value:function(bitDepthCode,numChannels,sampleRate,numBytes,samplesLength,options){this.container=options.container,this.chunkSize=36+samplesLength,this.format="WAVE",this.bitDepth=bitDepthCode,this.fmt={chunkId:"fmt ",chunkSize:16,audioFormat:this.WAV_AUDIO_FORMATS[bitDepthCode]||65534,numChannels:numChannels,sampleRate:sampleRate,byteRate:numChannels*numBytes*sampleRate,blockAlign:numChannels*numBytes,bitsPerSample:parseInt(bitDepthCode,10),cbSize:0,validBitsPerSample:0,dwChannelMask:0,subformat:[]}}},{key:"createADPCMHeader_",value:function(bitDepthCode,numChannels,sampleRate,numBytes,samplesLength,options){this.createPCMHeader_(bitDepthCode,numChannels,sampleRate,numBytes,samplesLength,options),this.chunkSize=40+samplesLength,this.fmt.chunkSize=20,this.fmt.byteRate=4055,this.fmt.blockAlign=256,this.fmt.bitsPerSample=4,this.fmt.cbSize=2,this.fmt.validBitsPerSample=505,this.fact={chunkId:"fact",chunkSize:4,dwSampleLength:2*samplesLength}}},{key:"createExtensibleHeader_",value:function(bitDepthCode,numChannels,sampleRate,numBytes,samplesLength,options){this.createPCMHeader_(bitDepthCode,numChannels,sampleRate,numBytes,samplesLength,options),this.chunkSize=60+samplesLength,this.fmt.chunkSize=40,this.fmt.bitsPerSample=1+(parseInt(bitDepthCode,10)-1|7),this.fmt.cbSize=22,this.fmt.validBitsPerSample=parseInt(bitDepthCode,10),this.fmt.dwChannelMask=function(numChannels){var mask=0;return 1===numChannels?mask=4:2===numChannels?mask=3:4===numChannels?mask=51:6===numChannels?mask=63:8===numChannels&&(mask=1599),mask}(numChannels),this.fmt.subformat=[1,1048576,2852126848,1905997824]}},{key:"createALawMulawHeader_",value:function(bitDepthCode,numChannels,sampleRate,numBytes,samplesLength,options){this.createPCMHeader_(bitDepthCode,numChannels,sampleRate,numBytes,samplesLength,options),this.chunkSize=40+samplesLength,this.fmt.chunkSize=20,this.fmt.cbSize=2,this.fmt.validBitsPerSample=8,this.fact={chunkId:"fact",chunkSize:4,dwSampleLength:samplesLength}}},{key:"bitDepthFromFmt_",value:function(){3===this.fmt.audioFormat&&32===this.fmt.bitsPerSample?this.bitDepth="32f":6===this.fmt.audioFormat?this.bitDepth="8a":7===this.fmt.audioFormat?this.bitDepth="8m":this.bitDepth=this.fmt.bitsPerSample.toString()}},{key:"validateBitDepth_",value:function(){if(!this.WAV_AUDIO_FORMATS[this.bitDepth]){if(parseInt(this.bitDepth,10)>8&&parseInt(this.bitDepth,10)<54)return!0;throw new Error("Invalid bit depth.")}return!0}},{key:"updateDataType_",value:function(){this.dataType={bits:1+(parseInt(this.bitDepth,10)-1|7),fp:"32f"==this.bitDepth||"64"==this.bitDepth,signed:"8"!=this.bitDepth,be:"RIFX"==this.container},["4","8a","8m"].indexOf(this.bitDepth)>-1&&(this.dataType.bits=8,this.dataType.signed=!1)}},{key:"validateWavHeader_",value:function(){if(this.validateBitDepth_(),channels=this.fmt.numChannels,bits=this.fmt.bitsPerSample,channels<1||channels*bits/8>65535)throw new Error("Invalid number of channels.");var channels,bits;if(!function(channels,bits,sampleRate){return!(sampleRate<1||channels*(bits/8)*sampleRate>4294967295)}(this.fmt.numChannels,this.fmt.bitsPerSample,this.fmt.sampleRate))throw new Error("Invalid sample rate.")}}]),WaveFileCreator}();var WaveFileMetaEditor=function(_WaveFileCreator){function WaveFileMetaEditor(){return classCallCheck(this,WaveFileMetaEditor),possibleConstructorReturn(this,(WaveFileMetaEditor.__proto__||Object.getPrototypeOf(WaveFileMetaEditor)).apply(this,arguments))}return inherits(WaveFileMetaEditor,WaveFileCreator),createClass(WaveFileMetaEditor,[{key:"getTag",value:function(tag){var index=this.getTagIndex_(tag);return null!==index.TAG?this.LIST[index.LIST].subChunks[index.TAG].value:null}},{key:"setTag",value:function(tag,value){tag=function(tag){if(tag.constructor!==String)throw new Error("Invalid tag name.");if(tag.length<4)for(var i=0,len=4-tag.length;i<len;i++)tag+=" ";return tag}(tag);var index=this.getTagIndex_(tag);null!==index.TAG?(this.LIST[index.LIST].subChunks[index.TAG].chunkSize=value.length+1,this.LIST[index.LIST].subChunks[index.TAG].value=value):null!==index.LIST?this.LIST[index.LIST].subChunks.push({chunkId:tag,chunkSize:value.length+1,value:value}):(this.LIST.push({chunkId:"LIST",chunkSize:8+value.length+1,format:"INFO",subChunks:[]}),this.LIST[this.LIST.length-1].subChunks.push({chunkId:tag,chunkSize:value.length+1,value:value}))}},{key:"deleteTag",value:function(tag){var index=this.getTagIndex_(tag);return null!==index.TAG&&(this.LIST[index.LIST].subChunks.splice(index.TAG,1),!0)}},{key:"listTags",value:function(){var index=this.getLISTINFOIndex_(),tags={};if(null!==index)for(var i=0,len=this.LIST[index].subChunks.length;i<len;i++)tags[this.LIST[index].subChunks[i].chunkId]=this.LIST[index].subChunks[i].value;return tags}},{key:"listCuePoints",value:function(){for(var points=this.getCuePoints_(),i=0,len=points.length;i<len;i++)points[i].milliseconds=points[i].dwPosition/this.fmt.sampleRate*1e3;return points}},{key:"setCuePoint",value:function(position){var labl=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.cue.chunkId="cue ",position=position*this.fmt.sampleRate/1e3;var existingPoints=this.getCuePoints_();this.clearLISTadtl_();var len=this.cue.points.length;this.cue.points=[];var hasSet=!1;if(0===len)this.setCuePoint_(position,1,labl);else{for(var i=0;i<len;i++)existingPoints[i].dwPosition>position&&!hasSet?(this.setCuePoint_(position,i+1,labl),this.setCuePoint_(existingPoints[i].dwPosition,i+2,existingPoints[i].label),hasSet=!0):this.setCuePoint_(existingPoints[i].dwPosition,i+1,existingPoints[i].label);hasSet||this.setCuePoint_(position,this.cue.points.length+1,labl)}this.cue.dwCuePoints=this.cue.points.length}},{key:"deleteCuePoint",value:function(index){this.cue.chunkId="cue ";var existingPoints=this.getCuePoints_();this.clearLISTadtl_();var len=this.cue.points.length;this.cue.points=[];for(var i=0;i<len;i++)i+1!==index&&this.setCuePoint_(existingPoints[i].dwPosition,i+1,existingPoints[i].label);this.cue.dwCuePoints=this.cue.points.length,this.cue.dwCuePoints?this.cue.chunkId="cue ":(this.cue.chunkId="",this.clearLISTadtl_())}},{key:"updateLabel",value:function(pointIndex,label){var cIndex=this.getAdtlChunk_();if(null!==cIndex)for(var i=0,len=this.LIST[cIndex].subChunks.length;i<len;i++)this.LIST[cIndex].subChunks[i].dwName==pointIndex&&(this.LIST[cIndex].subChunks[i].value=label)}},{key:"getCuePoints_",value:function(){for(var points=[],i=0,len=this.cue.points.length;i<len;i++)points.push({dwPosition:this.cue.points[i].dwPosition,label:this.getLabelForCuePoint_(this.cue.points[i].dwName)});return points}},{key:"getLabelForCuePoint_",value:function(pointDwName){var cIndex=this.getAdtlChunk_();if(null!==cIndex)for(var i=0,len=this.LIST[cIndex].subChunks.length;i<len;i++)if(this.LIST[cIndex].subChunks[i].dwName==pointDwName)return this.LIST[cIndex].subChunks[i].value;return""}},{key:"getLISTINFOIndex_",value:function(){for(var index=null,i=0,len=this.LIST.length;i<len;i++)if("INFO"===this.LIST[i].format){index=i;break}return index}},{key:"getAdtlChunk_",value:function(){for(var i=0,len=this.LIST.length;i<len;i++)if("adtl"==this.LIST[i].format)return i;return null}},{key:"getTagIndex_",value:function(tag){for(var index={LIST:null,TAG:null},i=0,len=this.LIST.length;i<len;i++)if("INFO"==this.LIST[i].format){index.LIST=i;for(var j=0,subLen=this.LIST[i].subChunks.length;j<subLen;j++)if(this.LIST[i].subChunks[j].chunkId==tag){index.TAG=j;break}break}return index}},{key:"setCuePoint_",value:function(position,dwName,label){this.cue.points.push({dwName:dwName,dwPosition:position,fccChunk:"data",dwChunkStart:0,dwBlockStart:0,dwSampleOffset:position}),this.setLabl_(dwName,label)}},{key:"clearLISTadtl_",value:function(){for(var i=0,len=this.LIST.length;i<len;i++)"adtl"==this.LIST[i].format&&this.LIST.splice(i)}},{key:"setLabl_",value:function(dwName,label){var adtlIndex=this.getAdtlChunk_();null===adtlIndex&&(this.LIST.push({chunkId:"LIST",chunkSize:4,format:"adtl",subChunks:[]}),adtlIndex=this.LIST.length-1),this.setLabelText_(null===adtlIndex?0:adtlIndex,dwName,label)}},{key:"setLabelText_",value:function(adtlIndex,dwName,label){this.LIST[adtlIndex].subChunks.push({chunkId:"labl",chunkSize:label.length,dwName:dwName,value:label}),this.LIST[adtlIndex].chunkSize+=label.length+4+4+4+1}}]),WaveFileMetaEditor}();var WaveFileConverter=function(_WaveFileMetaEditor){function WaveFileConverter(){return classCallCheck(this,WaveFileConverter),possibleConstructorReturn(this,(WaveFileConverter.__proto__||Object.getPrototypeOf(WaveFileConverter)).apply(this,arguments))}return inherits(WaveFileConverter,WaveFileMetaEditor),createClass(WaveFileConverter,[{key:"toRIFF",value:function(){this.fromExisting_(this.fmt.numChannels,this.fmt.sampleRate,this.bitDepth,unpackArray(this.data.samples,this.dataType))}},{key:"toRIFX",value:function(){this.fromExisting_(this.fmt.numChannels,this.fmt.sampleRate,this.bitDepth,unpackArray(this.data.samples,this.dataType),{container:"RIFX"})}},{key:"toIMAADPCM",value:function(){if(8e3!==this.fmt.sampleRate)throw new Error("Only 8000 Hz files can be compressed as IMA-ADPCM.");if(1!==this.fmt.numChannels)throw new Error("Only mono files can be compressed as IMA-ADPCM.");this.assure16Bit_();var output=new Int16Array(this.outputSize_());unpackArrayTo(this.data.samples,this.dataType,output),this.fromExisting_(this.fmt.numChannels,this.fmt.sampleRate,"4",function(samples){for(var adpcmSamples=new Uint8Array(samples.length),block=[],fileIndex=0,blockCount=0,i=0;i<samples.length;i++)i%505==0&&0!=i&&(adpcmSamples.set(encodeBlock(block),fileIndex),fileIndex+=256,block=[],blockCount++),block.push(samples[i]);var samplesLength=samples.length/2;return samplesLength%2&&samplesLength++,adpcmSamples.slice(0,samplesLength+512+4*blockCount)}(output),{container:this.correctContainer_()})}},{key:"fromIMAADPCM",value:function(){var bitDepthCode=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"16";this.fromExisting_(this.fmt.numChannels,this.fmt.sampleRate,"16",function(adpcmSamples){for(var blockAlign=arguments.length>1&&void 0!==arguments[1]?arguments[1]:256,samples=new Int16Array(2*adpcmSamples.length),block=[],fileIndex=0,i=0;i<adpcmSamples.length;i++){if(i%blockAlign==0&&0!=i){var decoded=decodeBlock(block);samples.set(decoded,fileIndex),fileIndex+=decoded.length,block=[]}block.push(adpcmSamples[i])}return samples}(this.data.samples,this.fmt.blockAlign),{container:this.correctContainer_()}),"16"!=bitDepthCode&&this.toBitDepth(bitDepthCode)}},{key:"toALaw",value:function(){this.assure16Bit_();var output=new Int16Array(this.outputSize_());unpackArrayTo(this.data.samples,this.dataType,output),this.fromExisting_(this.fmt.numChannels,this.fmt.sampleRate,"8a",function(samples){for(var aLawSamples=new Uint8Array(samples.length),i=0;i<samples.length;i++)aLawSamples[i]=encodeSample(samples[i]);return aLawSamples}(output),{container:this.correctContainer_()})}},{key:"fromALaw",value:function(){var bitDepthCode=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"16";this.fromExisting_(this.fmt.numChannels,this.fmt.sampleRate,"16",function(samples){for(var pcmSamples=new Int16Array(samples.length),i=0;i<samples.length;i++)pcmSamples[i]=decodeSample(samples[i]);return pcmSamples}(this.data.samples),{container:this.correctContainer_()}),"16"!=bitDepthCode&&this.toBitDepth(bitDepthCode)}},{key:"toMuLaw",value:function(){this.assure16Bit_();var output=new Int16Array(this.outputSize_());unpackArrayTo(this.data.samples,this.dataType,output),this.fromExisting_(this.fmt.numChannels,this.fmt.sampleRate,"8m",function(samples){for(var sample,sign,exponent,muLawSamples=new Uint8Array(samples.length),i=0;i<samples.length;i++)muLawSamples[i]=(sample=samples[i],sign=void 0,exponent=void 0,0!=(sign=sample>>8&128)&&(sample=-sample),sample>CLIP&&(sample=CLIP),~(sign|(exponent=encodeTable[(sample+=BIAS)>>7&255])<<4|sample>>exponent+3&15));return muLawSamples}(output),{container:this.correctContainer_()})}},{key:"fromMuLaw",value:function(){var bitDepthCode=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"16";this.fromExisting_(this.fmt.numChannels,this.fmt.sampleRate,"16",function(samples){for(var muLawSample,sign,exponent,mantissa,sample,pcmSamples=new Int16Array(samples.length),i=0;i<samples.length;i++)pcmSamples[i]=(muLawSample=samples[i],sign=void 0,exponent=void 0,mantissa=void 0,sample=void 0,sample=void 0,sign=128&(muLawSample=~muLawSample),mantissa=15&muLawSample,sample=decodeTable[exponent=muLawSample>>4&7]+(mantissa<<exponent+3),0!=sign&&(sample=-sample),sample);return pcmSamples}(this.data.samples),{container:this.correctContainer_()}),"16"!=bitDepthCode&&this.toBitDepth(bitDepthCode)}},{key:"toBitDepth",value:function(newBitDepth){var changeResolution=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],toBitDepth=newBitDepth,thisBitDepth=this.bitDepth;changeResolution||("32f"!=newBitDepth&&(toBitDepth=this.dataType.bits.toString()),thisBitDepth=this.dataType.bits),this.assureUncompressed_();var sampleCount=this.data.samples.length/(this.dataType.bits/8),typedSamplesInput=new Float64Array(sampleCount),typedSamplesOutput=new Float64Array(sampleCount);unpackArrayTo(this.data.samples,this.dataType,typedSamplesInput),"32f"!=thisBitDepth&&"64"!=thisBitDepth||function(samples){for(var i=0,len=samples.length;i<len;i++)samples[i]>1?samples[i]=1:samples[i]<-1&&(samples[i]=-1)}(typedSamplesInput),bitDepth(typedSamplesInput,thisBitDepth,toBitDepth,typedSamplesOutput),this.fromExisting_(this.fmt.numChannels,this.fmt.sampleRate,newBitDepth,typedSamplesOutput,{container:this.correctContainer_()})}},{key:"assure16Bit_",value:function(){this.assureUncompressed_(),"16"!=this.bitDepth&&this.toBitDepth("16")}},{key:"assureUncompressed_",value:function(){"8a"==this.bitDepth?this.fromALaw():"8m"==this.bitDepth?this.fromMuLaw():"4"==this.bitDepth&&this.fromIMAADPCM()}},{key:"correctContainer_",value:function(){return"RF64"==this.container?"RIFF":this.container}},{key:"fromExisting_",value:function(numChannels,sampleRate,bitDepthCode,samples){var options=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},tmpWav=new WaveFileMetaEditor;Object.assign(this.fmt,tmpWav.fmt),Object.assign(this.fact,tmpWav.fact),Object.assign(this.ds64,tmpWav.ds64),Object.assign(this.data,tmpWav.data),this.newWavFile_(numChannels,sampleRate,bitDepthCode,samples,options)}},{key:"outputSize_",value:function(){var outputSize=this.data.samples.length/2;return outputSize%2&&outputSize++,outputSize}}]),WaveFileConverter}();return function(_WaveFileConverter){function WaveFile(){var wavBuffer=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;classCallCheck(this,WaveFile);var _this=possibleConstructorReturn(this,(WaveFile.__proto__||Object.getPrototypeOf(WaveFile)).call(this));return wavBuffer&&_this.fromBuffer(wavBuffer),_this}return inherits(WaveFile,WaveFileConverter),createClass(WaveFile,[{key:"fromBase64",value:function(base64String){this.fromBuffer(new Uint8Array(function(base64){var len=base64.length,bufferLength=.75*base64.length,p=0,encoded1=void 0,encoded2=void 0,encoded3=void 0,encoded4=void 0;"="===base64[base64.length-1]&&(bufferLength--,"="===base64[base64.length-2]&&bufferLength--);for(var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer),_i2=0;_i2<len;_i2+=4)encoded1=lookup[base64.charCodeAt(_i2)],encoded2=lookup[base64.charCodeAt(_i2+1)],encoded3=lookup[base64.charCodeAt(_i2+2)],encoded4=lookup[base64.charCodeAt(_i2+3)],bytes[p++]=encoded1<<2|encoded2>>4,bytes[p++]=(15&encoded2)<<4|encoded3>>2,bytes[p++]=(3&encoded3)<<6|63&encoded4;return arraybuffer}(base64String)))}},{key:"toBase64",value:function(){var buffer=this.toBuffer();return function(arraybuffer,byteOffset,length){for(var bytes=new Uint8Array(arraybuffer,byteOffset,length),len=bytes.length,base64="",_i=0;_i<len;_i+=3)base64+=chars[bytes[_i]>>2],base64+=chars[(3&bytes[_i])<<4|bytes[_i+1]>>4],base64+=chars[(15&bytes[_i+1])<<2|bytes[_i+2]>>6],base64+=chars[63&bytes[_i+2]];return len%3==2?base64=base64.substring(0,base64.length-1)+"=":len%3==1&&(base64=base64.substring(0,base64.length-2)+"=="),base64}(buffer,0,buffer.length)}},{key:"toDataURI",value:function(){return"data:audio/wav;base64,"+this.toBase64()}},{key:"fromDataURI",value:function(dataURI){this.fromBase64(dataURI.replace("data:audio/wav;base64,",""))}}]),WaveFile}()});
